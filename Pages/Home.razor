@page "/"

<PageTitle>投資增長計算器</PageTitle>

<style>
    .container {
        max-width: 600px;
        margin: 20px auto;
        padding: 25px;
        background-color: #ffffff;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h3 {
        color: #2c3e50;
        text-align: center;
        font-weight: 700;
        margin-bottom: 30px;
    }

    .form-group {
        margin-bottom: 18px;
    }

    label {
        display: block;
        margin-bottom: 6px;
        font-size: 14px;
        color: #7f8c8d;
    }

    input {
        width: 100%;
        padding: 12px;
        border: 2px solid #eee;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
    }

    input:focus {
        border-color: #3498db;
        outline: none;
    }

    button {
        width: 100%;
        padding: 15px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
    }

    button:hover {
        background-color: #2980b9;
    }

    /* 結果顯示區域 */
    .result-card {
        margin-top: 30px;
        padding: 20px;
        background-color: #fcfcfc;
        border-radius: 10px;
        border: 1px solid #f1f1f1;
    }

    .result-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px dashed #eee;
    }

    .result-item:last-child {
        border-bottom: none;
        padding-top: 15px;
        margin-top: 5px;
    }

    .label-text { color: #555; }
    .value-text { font-weight: 600; color: #333; }
    .total-highlight { 
        font-size: 1.2rem; 
        color: #e67e22 !important; 
        font-weight: 800;
    }

    @@media (max-width: 480px) {
        .container { margin: 10px; padding: 15px; }
    }
</style>

<div class="container">
    <h3>📈 投資增長計算器</h3>

    <div class="form-group">
        <label>每月投資金額 (TWD)</label>
        <input type="number" @bind="monthlyInvestment" />
    </div>

    <div class="form-group">
        <label>年化報酬率 (%)</label>
        <input type="number" @bind="annualReturnRate" />
    </div>

    <div class="form-group">
        <label>投資年數</label>
        <input type="number" @bind="years" />
    </div>

    <button @onclick="Calculate">開始精算</button>

    @* 只要有結果就顯示 *@
    @if (showResult)
    {
        <div class="result-card">
            <div class="result-item">
                <span class="label-text">總投入成本 (本金)</span>
                <span class="value-text">@totalCost.ToString("N0") TWD</span>
            </div>
            <div class="result-item">
                <span class="label-text">單利成長 (本+利)</span>
                <span class="value-text">@simpleInterestResult.ToString("N0") TWD</span>
            </div>
            <div class="result-item">
                <span class="label-text">複利滾動 (最終價值)</span>
                <span class="value-text total-highlight">@compoundInterestResult.ToString("N0") TWD</span>
            </div>
            <p style="font-size: 13px; color: #2ecc71; margin-top: 15px; text-align: center; font-weight: bold;">
                ✨ 複利讓您的資產多增長了 @((compoundInterestResult - totalCost).ToString("N0")) 元！
            </p>
        </div>
    }
</div>

@code {
    // 1. 在這裡設定預設值
    private double monthlyInvestment = 20000;
    private double annualReturnRate = 7;
    private int years = 10;
    
    private double totalCost;
    private double simpleInterestResult;
    private double compoundInterestResult;
    private bool showResult = false;

    // 2. 初始化生命週期：讓網頁一開啟就先算好一次
    protected override void OnInitialized()
    {
        Calculate();
    }

    private void Calculate()
    {
        if (monthlyInvestment <= 0 || years <= 0) return;

        double r = annualReturnRate / 100;
        double monthlyR = r / 12;
        int months = years * 12;

        totalCost = monthlyInvestment * months;

        // 單利邏輯
        simpleInterestResult = totalCost + (totalCost * r * (years + 1.0/12) / 2);

        // 複利邏輯
        if (r == 0)
        {
            compoundInterestResult = totalCost;
        }
        else
        {
            compoundInterestResult = monthlyInvestment * (Math.Pow(1 + monthlyR, months) - 1) / monthlyR * (1 + monthlyR);
        }

        showResult = true;
    }
}